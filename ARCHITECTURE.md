# 🏛️ Архитектура облачной платформы для электронной библиотеки

## 📋 Оглавление
- [Обзор системы](#обзор-системы)
- [Микросервисная архитектура](#микросервисная-архитектура)
- [Схема взаимодействия](#схема-взаимодействия)
- [Описание сервисов](#описание-сервисов)
- [Сетевая архитектура](#сетевая-архитектура)
- [Масштабирование](#масштабирование)
- [Безопасность](#безопасность)

---

## 🎯 Обзор системы

Облачная платформа представляет собой **микросервисную архитектуру** из **5 изолированных контейнеров**, развернутых с использованием Docker и Docker Compose.

### Ключевые характеристики:
- ✅ **5 Docker контейнеров** (MongoDB, Redis, Backend API, Frontend, Nginx LB)
- ✅ **Микросервисная архитектура** с изоляцией сервисов
- ✅ **Кластеризация** и горизонтальное масштабирование
- ✅ **Кеширование** данных через Redis
- ✅ **Load Balancing** через Nginx
- ✅ **Health Checks** для всех сервисов
- ✅ **Изолированные сети** для безопасности
- ✅ **Persistent Volumes** для сохранности данных

---

## 🏗️ Микросервисная архитектура

```
┌─────────────────────────────────────────────────────────────┐
│                    КЛИЕНТ (Браузер)                         │
└──────────────────────┬──────────────────────────────────────┘
                       │ HTTP/HTTPS (Port 80/443)
                       ↓
┌─────────────────────────────────────────────────────────────┐
│   🔀 Nginx Load Balancer (Контейнер #5)                     │
│   - Reverse Proxy                                            │
│   - Load Balancing                                           │
│   - SSL Termination                                          │
│   - Health Checks                                            │
└──────────┬────────────────────┬─────────────────────────────┘
           │                    │
           │ /api/*             │ /*
           ↓                    ↓
┌──────────────────────┐  ┌─────────────────────────┐
│  ⚙️  Backend API      │  │  🎨 Frontend (Nginx)    │
│  (Контейнер #3)       │  │  (Контейнер #4)         │
│  - Node.js/Express    │  │  - HTML/CSS/JS          │
│  - REST API           │  │  - Статический контент  │
│  - Бизнес-логика      │  │                         │
└──────────┬────────────┘  └─────────────────────────┘
           │
           ├──────────────┬───────────────┐
           ↓              ↓               ↓
┌──────────────────┐ ┌───────────────┐  
│  🗄️  MongoDB      │ │  ⚡ Redis      │  
│  (Контейнер #1)  │ │  (Контейнер #2)│  
│  - База данных   │ │  - Кеширование │  
│  - Постоянство   │ │  - Сессии      │  
└──────────────────┘ └───────────────┘  
```

---

## 📦 Описание сервисов

### 1️⃣ MongoDB (База данных)
**Контейнер:** `library-mongo`  
**Образ:** `mongo:7`  
**Порты:** Внутренний 27017  
**Ресурсы:** 512MB RAM, 1.0 CPU

**Функции:**
- Хранение данных библиотеки (книги, пользователи, истории)
- Индексирование для быстрого поиска
- Репликация данных
- Persistent storage через Docker volumes

**Healthcheck:**
```bash
mongosh localhost:27017/library --eval "db.runCommand('ping')"
```

---

### 2️⃣ Redis (Кеширование)
**Контейнер:** `library-redis`  
**Образ:** `redis:7-alpine`  
**Порты:** Внутренний 6379  
**Ресурсы:** 256MB RAM, 0.5 CPU

**Функции:**
- Кеширование API запросов (TTL: 60 секунд)
- Управление сессиями пользователей
- Инвалидация кеша при изменении данных
- AOF (Append-Only File) для персистентности

**Стратегия кеширования:**
```
GET /api/books → Кеш на 60 сек
POST/PUT/DELETE → Инвалидация всего кеша books:*
```

**Healthcheck:**
```bash
redis-cli ping
```

---

### 3️⃣ Backend API (Node.js)
**Контейнер:** `library-backend`  
**Образ:** `library-backend:latest`  
**Порты:** Внутренний 3000  
**Ресурсы:** 512MB RAM, 1.0 CPU

**Технологический стек:**
- Node.js 18
- Express.js 4.18
- Mongoose 8.0 (MongoDB ODM)
- Redis Client 4.6
- CORS support

**API Endpoints:**
| Метод | Endpoint | Описание |
|-------|----------|----------|
| GET | /api/books | Получить все книги (кешируется) |
| GET | /api/books/:id | Получить книгу по ID |
| POST | /api/books | Добавить книгу |
| PUT | /api/books/:id | Обновить книгу |
| DELETE | /api/books/:id | Удалить книгу |
| GET | /api/search | Поиск книг |
| GET | /api/stats | Статистика библиотеки |

**Функции:**
- RESTful API
- Валидация данных
- Логирование всех запросов
- Обработка ошибок
- Интеграция с Redis для кеширования
- Автоматическая инвалидация кеша

**Healthcheck:**
```bash
node -e "require('http').get('http://localhost:3000/api/stats', ...)"
```

---

### 4️⃣ Frontend (Nginx)
**Контейнер:** `library-frontend`  
**Образ:** `library-frontend:latest`  
**Порты:** Внутренний 80  
**Ресурсы:** 256MB RAM, 0.5 CPU

**Содержимое:**
- HTML5 интерфейс
- CSS3 стили (градиенты, анимации)
- Vanilla JavaScript (без фреймворков)
- Адаптивный дизайн

**Функции:**
- Отображение списка книг
- Формы добавления/редактирования
- Поиск по книгам
- Модальные окна
- Статистика в реальном времени

**Healthcheck:**
```bash
wget --spider http://127.0.0.1/
```

---

### 5️⃣ Nginx Load Balancer
**Контейнер:** `library-nginx-lb`  
**Образ:** `library-nginx-lb:latest`  
**Порты:** 80 (HTTP), 443 (HTTPS)  
**Ресурсы:** 256MB RAM, 0.5 CPU

**Функции:**
- **Reverse Proxy** для всех сервисов
- **Load Balancing** между репликами backend
- **SSL Termination** (для HTTPS)
- **Health Check endpoint** `/health`
- **Маршрутизация:**
  - `/api/*` → Backend API
  - `/*` → Frontend

**Конфигурация upstream:**
```nginx
upstream backend_servers {
    server backend:3000 max_fails=3 fail_timeout=30s;
}

upstream frontend_servers {
    server frontend:80 max_fails=3 fail_timeout=30s;
}
```

**Healthcheck:**
```bash
wget --spider http://localhost/health
```

---

## 🌐 Сетевая архитектура

### Изолированные сети

#### 1. Backend Network (library-backend-net)
**Участники:** MongoDB, Redis, Backend API  
**Тип:** Bridge (internal)  
**Назначение:** Изоляция данных от публичного доступа

```
┌──────────────────────────────────────┐
│   Backend Network (Internal)         │
│   ┌────────┐  ┌───────┐  ┌────────┐ │
│   │ MongoDB│──│ Redis │──│Backend │ │
│   └────────┘  └───────┘  └────────┘ │
└──────────────────────────────────────┘
```

#### 2. App Network (library-app-net)
**Участники:** Backend API, Frontend, Nginx LB  
**Тип:** Bridge (public)  
**Назначение:** Маршрутизация пользовательских запросов

```
┌───────────────────────────────────────┐
│   App Network (Public)                │
│   ┌────────┐  ┌────────┐  ┌────────┐ │
│   │Nginx LB│──│Frontend│  │Backend │ │
│   └────────┘  └────────┘  └────────┘ │
└───────────────────────────────────────┘
```

### Преимущества изоляции:
- ✅ MongoDB и Redis недоступны извне
- ✅ Backend имеет доступ к обеим сетям
- ✅ Nginx LB — единственная точка входа
- ✅ Защита от несанкционированного доступа

---

## 📈 Масштабирование

### Горизонтальное масштабирование

#### Backend API (2+ реплики)
```yaml
deploy:
  replicas: 2
```

**Преимущества:**
- Load balancing между репликами
- Высокая доступность (HA)
- Отказоустойчивость
- Rolling updates без простоя

#### Масштабирование на лету:
```bash
docker-compose up -d --scale backend=5
```

### Вертикальное масштабирование

**Ограничения ресурсов:**
```yaml
deploy:
  resources:
    limits:
      cpus: '1.0'
      memory: 512M
    reservations:
      cpus: '0.25'
      memory: 128M
```

---

## 🔒 Безопасность

### Меры безопасности:

1. **Сетевая изоляция**
   - MongoDB и Redis в закрытой сети
   - Только Backend имеет доступ к БД

2. **Health Checks**
   - Автоматический перезапуск нездоровых контейнеров
   - Мониторинг состояния каждые 10-30 секунд

3. **Ограничение ресурсов**
   - CPU и RAM limits
   - Защита от DoS атак

4. **CORS**
   - Настроенный CORS в Backend
   - Защита от XSS

5. **Логирование**
   - Все запросы логируются
   - Отслеживание ошибок

---

## 💾 Persistent Storage

### Volumes для сохранности данных:

```yaml
volumes:
  mongo_data:       # Данные MongoDB
  mongo_config:     # Конфигурация MongoDB  
  redis_data:       # AOF файлы Redis
```

**Преимущества:**
- ✅ Данные сохраняются при перезапуске
- ✅ Backup-friendly
- ✅ Миграция между хостами
- ✅ Отдельное управление данными

---

## 🚀 Запуск и управление

### Команды запуска:

```bash
# Запуск всей платформы
./deployment/start.sh

# Остановка
./deployment/stop.sh

# Мониторинг
./deployment/monitor.sh

# Логи
docker-compose logs -f [service]

# Масштабирование
docker-compose up -d --scale backend=5
```

---

## 📊 Мониторинг

### Доступные метрики:

- **Healthcheck статусы** всех контейнеров
- **CPU/RAM** использование каждого сервиса
- **Сетевой трафик** (NetIO)
- **API запросы** через логи
- **Cache hit/miss ratio** через Redis

### Endpoints мониторинга:

- `http://localhost/health` - Load Balancer health
- `http://localhost/api/stats` - API statistics
- `docker-compose ps` - Контейнеры статус
- `docker stats` - Ресурсы в реальном времени

---

## 🎓 Для защиты курсовой работы

### Демонстрация облачных технологий:

1. **Микросервисы** ✅
   - 5 изолированных контейнеров
   - Каждый выполняет одну функцию

2. **Масштабирование** ✅
   - Горизонтальное (реплики)
   - Вертикальное (ресурсы)

3. **Отказоустойчивость** ✅
   - Health checks
   - Автоперезапуск
   - Load balancing

4. **Кеширование** ✅
   - Redis интеграция
   - TTL стратегия

5. **Безопасность** ✅
   - Сетевая изоляция
   - CORS защита
   - Ограничение ресурсов

---

## 📝 Технологии

| Компонент | Технология | Версия |
|-----------|-----------|--------|
| База данных | MongoDB | 7 |
| Кеш | Redis | 7-alpine |
| Backend | Node.js | 18 |
| Backend Framework | Express.js | 4.18 |
| Frontend | HTML/CSS/JS | Native |
| Web Server | Nginx | Alpine |
| Load Balancer | Nginx | Alpine |
| Orchestration | Docker Compose | 3.8 |
| ODM | Mongoose | 8.0 |
| Cache Client | Redis Client | 4.6 |

---

**Разработано для курсовой работы:**  
*"Настройка и администрирование облачной платформы для управления электронной библиотекой и архивом"*
